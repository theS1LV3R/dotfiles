#zmodload zsh/zprof

zmodload zsh/complist
autoload -U compinit && compinit
autoload -U bashcompinit && bashcompinit

export DOTFILES_DIR={{ .chezmoi.sourceDir }}
export SCRIPTS_DIR="$HOME/.config/zsh"
export GPG_TTY=$(tty)
export fpath=($SCRIPTS_DIR/completions $fpath)

# Zi options
declare -A ZI

ZI[HOME_DIR]="${DOTFILES_DIR}/zi"
ZI[BIN_DIR]="${ZI[HOME_DIR]}/bin"

export zi_home="${ZI[HOME_DIR]}"
source "${zi_home}/bin/zi.zsh"

autoload -Uz _zi
(( ${+_comps} )) && _comps[zi]=_zi

#! SOURCE **BEFORE** ANTIGEN
#! IMPORTANT
source $SCRIPTS_DIR/zsh-autocomplete.zsh

# p10k (Prompt)

if [[ "${TERM}" == "linux" ]]; then
    source $SCRIPTS_DIR/zshrc/basic-prompt.zsh
else
    source $SCRIPTS_DIR/p10k.init.zsh
fi

# Everything else zsh related
source $SCRIPTS_DIR/zsh.init.zsh

# P10K theme
zi ice if"[ "${TERM##*-}" = '256color' ] || [ "${terminfo[colors]:?}" -gt 255 ]" depth=1
zi light romkatv/powerlevel10k

# Various other stuff
zi load zsh-users/zsh-syntax-highlighting
zi load zsh-users/zsh-autosuggestions
zi load zsh-users/zsh-completions

omz_plugins=(
    pip
    aws
    command-not-found
    docker
    docker-compose
    node
    gitignore
    git
    aliases
    archlinux
)

for plugin in "${omz_plugins[@]}"; do
    zi snippet OMZP::${plugin}
done

zi light-mode for z-shell/z-a-meta-plugins @annexes

zicompinit
